{
	"info": {
		"_postman_id": "dfbbb51b-e520-45e8-a5ea-e189e6f10635",
		"name": "Usuario",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "39663065"
	},
	"item": [
		{
			"name": "clientes",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"",
							"pm.test(\"Client created successfully - Status code is 201 or 200\", function () {",
							"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
							"});",
							"",
							"// Parse response and request data",
							"var responseData = pm.response.json();",
							"var requestData = JSON.parse(pm.request.body.raw);",
							"",
							"// 2. Validate response contains expected fields",
							"pm.test(\"Response contains all required fields\", function () {",
							"    pm.expect(responseData).to.be.an('array').that.is.not.empty;",
							"    var client = responseData[0];",
							"    pm.expect(client).to.have.property('nome');",
							"    pm.expect(client).to.have.property('email');",
							"    pm.expect(client).to.have.property('telefone');",
							"});",
							"",
							"// 3. Check response data matches request data",
							"pm.test(\"Response data matches request data\", function () {",
							"    var client = responseData[0];",
							"    pm.expect(client.nome).to.eql(requestData.nome, \"Nome should match the request\");",
							"    pm.expect(client.email).to.eql(requestData.email, \"Email should match the request\");",
							"    pm.expect(client.telefone).to.eql(requestData.telefone, \"Telefone should match the request\");",
							"});",
							"",
							"// 4. Validate that an ID was generated",
							"pm.test(\"Client ID was generated\", function () {",
							"    var client = responseData[0];",
							"    pm.expect(client).to.have.property('id');",
							"    pm.expect(client.id).to.not.be.null;",
							"    pm.expect(client.id).to.not.be.undefined;",
							"});",
							"",
							"// 5. Save client ID to collection variable for subsequent requests",
							"pm.test(\"Client ID saved to collection variable\", function () {",
							"    var client = responseData[0];",
							"    if (client.id) {",
							"        pm.collectionVariables.set(\"clientId\", client.id);",
							"        console.log(\"Client ID saved: \" + client.id);",
							"    }",
							"});",
							"",
							"// 6. Success message",
							"pm.test(\"✓ Client creation confirmed\", function () {",
							"    var client = responseData[0];",
							"    console.log(\"✓ Successfully created client: \" + client.nome + \" (ID: \" + client.id + \")\");",
							"    pm.expect(true).to.be.true;",
							"});",
							"",
							"// 7. Additional validations for client creation endpoint",
							"",
							"// Validate email format",
							"pm.test(\"Email has valid format\", function () {",
							"    var client = responseData[0];",
							"    var emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;",
							"    pm.expect(client.email).to.match(emailRegex, \"Email should be in valid format\");",
							"});",
							"",
							"// Validate nome is not empty",
							"pm.test(\"Nome is not empty\", function () {",
							"    var client = responseData[0];",
							"    pm.expect(client.nome).to.be.a('string').and.not.empty;",
							"});",
							"",
							"// Validate telefone is not empty",
							"pm.test(\"Telefone is not empty\", function () {",
							"    var client = responseData[0];",
							"    pm.expect(client.telefone).to.be.a('string').and.not.empty;",
							"});",
							"",
							"// Check response time is acceptable",
							"pm.test(\"Response time is acceptable (< 2000ms)\", function () {",
							"    pm.expect(pm.response.responseTime).to.be.below(2000);",
							"});",
							"",
							"// Validate response is JSON",
							"pm.test(\"Response is valid JSON\", function () {",
							"    pm.response.to.be.json;",
							"});",
							"",
							"// Check for timestamp fields if they exist (common in database records)",
							"pm.test(\"Timestamp fields exist (if applicable)\", function () {",
							"    var client = responseData[0];",
							"    if (client.created_at || client.createdAt) {",
							"        pm.expect(client.created_at || client.createdAt).to.exist;",
							"        console.log(\"Created at: \" + (client.created_at || client.createdAt));",
							"    }",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "apikey",
						"value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvdmVxdnFnd3F1cW1ybHhza3duIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMzk0MDYsImV4cCI6MjA3OTcxNTQwNn0.S95P_Aaypec0bKbQXFjBVsYM97_m9NHXq03xRqFsXwQ",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvdmVxdnFnd3F1cW1ybHhza3duIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMzk0MDYsImV4cCI6MjA3OTcxNTQwNn0.S95P_Aaypec0bKbQXFjBVsYM97_m9NHXq03xRqFsXwQ",
						"type": "text"
					},
					{
						"key": "Pefer",
						"value": "return=representation",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n  \"nome\": \"Joaõ da silva\",\r\n  \"email\": \"Davidsfelipe@gmail.com\",\r\n  \"telefone\": \"999999999\"\r\n}\r\n\r\n",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{path}}/rest/v1/clientes",
					"host": [
						"{{path}}"
					],
					"path": [
						"rest",
						"v1",
						"clientes"
					]
				}
			},
			"response": []
		},
		{
			"name": "Atualizar_cliente",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status 200 - Produto atualizado\", function () {\r",
							"    pm.expect(pm.response.code).to.eql(200);\r",
							"});\r",
							"\r",
							"let res = pm.response.json();\r",
							"\r",
							"pm.test(\"Retornou o produto atualizado\", function () {\r",
							"    pm.expect(res).to.be.an(\"array\").that.is.not.empty;\r",
							"});\r",
							"\r",
							"let produto = res[0];\r",
							"\r",
							"pm.test(\"Salvar ID do produto atualizado\", function () {\r",
							"    pm.environment.set(\"id_produto\", produto.id);\r",
							"});\r",
							"\r",
							"console.log(\"✔ Produto atualizado com sucesso:\", produto.nome);\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "PATCH",
				"header": [
					{
						"key": "apikey",
						"value": "{{apikey}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{apikey}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Prefer",
						"value": "return=representation",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\r\n    \"telefone\":\"88 9816-89700\"\r\n\r\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{path}}/rest/v1/clientes?id=eq.{{id_clientes}}",
					"host": [
						"{{path}}"
					],
					"path": [
						"rest",
						"v1",
						"clientes"
					],
					"query": [
						{
							"key": "id",
							"value": "eq.{{id_clientes}}"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Deletar_cliente",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status deve ser 204 (Item deletado)\", function () {\r",
							"    pm.expect(pm.response.code).to.be.oneOf([200, 204]);\r",
							"});\r",
							"\r",
							"// Se retornar dados do item deletado (se usar return=representation)\r",
							"if (pm.response.code === 200) {\r",
							"    let res = pm.response.json();\r",
							"    pm.test(\"Retornou dados do item deletado\", function () {\r",
							"        pm.expect(res).to.be.an('array').that.is.not.empty;\r",
							"    });\r",
							"}\r",
							"\r",
							"// Confirmação no console\r",
							"console.log(\"✓ Cliente deletado com sucesso. ID:\", pm.collectionVariables.get(\"clientId\"));\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [
					{
						"key": "apikey",
						"value": "{{apikey}}",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "Bearer {{apikey}}",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Prefer",
						"value": "return=representation",
						"type": "text"
					}
				],
				"url": {
					"raw": "{{path}}/rest/v1/clientes?id=eq.{{id_clientes}}",
					"host": [
						"{{path}}"
					],
					"path": [
						"rest",
						"v1",
						"clientes"
					],
					"query": [
						{
							"key": "id",
							"value": "eq.{{id_clientes}}"
						}
					]
				}
			},
			"response": []
		}
	]
}